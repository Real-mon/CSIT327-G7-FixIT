{% extends "base.html" %}

{% block title %}Dashboard - FixIT{% endblock %}

{% block sidebar %}{% include 'sidebars/sidebar_technician.html' %}{% endblock %}

{% block content %}
<div class="relative min-h-screen">
    <div class="flex">
        
        
        <!-- Main Content -->
        <div class="flex-1 p-12 bg-[#f7faff] min-h-screen">
            <div class="mb-10">
                <h1 class="text-4xl font-extrabold text-[#0245a3] mb-3">Technical Dashboard</h1>
                <p class="text-[#0245a3]/80 text-lg">Manage and resolve support tickets efficiently</p>
            </div>

            <!-- Assigned Tickets Section -->
            <div class="max-w-6xl mx-auto mb-8 bg-white rounded-2xl shadow-lg border border-[#8fbaf3]/20 p-6">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6">
                    <div>
                        <h2 class="text-xl font-semibold text-[#0245a3]">Assigned Tickets</h2>
                        <p class="text-sm text-[#0245a3]/70">View and manage tickets assigned to you</p>
                    </div>
                    <a href="{% url 'technician_tickets' %}" class="mt-4 md:mt-0 bg-gradient-to-r from-[#8fbaf3] to-[#0245a3] text-white font-semibold rounded-xl px-6 py-3 hover:opacity-90 transition">
                        View All Assigned
                    </a>
                </div>
            </div>

            <!-- Stats Overview -->
            <div class="max-w-6xl mx-auto mb-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Active Tickets -->
                <div class="bg-white rounded-2xl shadow-lg border border-[#8fbaf3]/20 p-6">
                    <div class="text-3xl font-bold text-[#0245a3] mb-2">{{ total_tickets }}</div>
                    <div class="text-lg font-medium text-[#0245a3]">Active Tickets</div>
                    <div class="text-sm text-[#0245a3]/70 mt-1">Tickets requiring attention</div>
                </div>

                <!-- Resolved Tickets -->
                <div class="bg-white rounded-2xl shadow-lg border border-[#8fbaf3]/20 p-6">
                    <div class="text-3xl font-bold text-[#0245a3] mb-2">{{ resolved_tickets }}</div>
                    <div class="text-lg font-medium text-[#0245a3]">Resolved Tickets</div>
                    <div class="text-sm text-[#0245a3]/70 mt-1">Number of tickets successfully closed</div>
                </div>

                <!-- Agent Response Time -->
                <div class="bg-white rounded-2xl shadow-lg border border-[#8fbaf3]/20 p-6">
                    <div class="text-3xl font-bold text-[#0245a3] mb-2">{{ tech_avg_response_time_display }}</div>
                    <div class="text-lg font-medium text-[#0245a3]">Agent Response Time</div>
                    <div class="text-sm text-[#0245a3]/70 mt-1">Average first response time</div>
                </div>

                <!-- Pending Tickets -->
                <div class="bg-white rounded-2xl shadow-lg border border-[#8fbaf3]/20 p-6">
                    <div class="text-3xl font-bold text-[#0245a3] mb-2">5</div>
                    <div class="text-lg font-medium text-[#0245a3]">Pending Tickets</div>
                    <div class="text-sm text-[#0245a3]/70 mt-1">Tickets waiting for user reply</div>
                </div>
            </div>

            <!-- Recent Activity -->
           <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-lg border border-[#8fbaf3]/20 p-6">
    <h2 class="text-xl font-semibold text-[#0245a3] mb-6">Recent Activity</h2>

    <div class="space-y-4 max-h-72 overflow-y-auto pr-2">
        {% for ticket in tickets %}
        <div class="flex items-start space-x-4 pb-4 border-b border-[#8fbaf3]/20">

            <!-- ICON BASED ON STATUS -->
            {% if ticket.status == "open" %}
            <div class="w-10 h-10 bg-gradient-to-r from-[#8fbaf3] to-[#0245a3] rounded-full flex items-center justify-center text-white">
                <i class="fas fa-ticket-alt text-sm"></i>
            </div>
            {% elif ticket.status == "resolved" %}
            <div class="w-10 h-10 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center text-white">
                <i class="fas fa-check text-sm"></i>
            </div>
            {% else %}
            <div class="w-10 h-10 bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center text-white">
                <i class="fas fa-clock text-sm"></i>
            </div>
            {% endif %}

            <!-- TEXT DETAILS -->
            <div class="flex-1">
                <p class="text-[#0245a3] font-medium">
                    Ticket #{{ ticket.id }} — {{ ticket.get_status_display }}
                </p>
                <p class="text-sm text-[#0245a3]/70">
                    {{ ticket.title }} — Priority {{ ticket.priority }}
                </p>
                <p class="text-xs text-[#0245a3]/50 mt-1">
                    {{ ticket.created_at|timesince }} ago
                </p>
            </div>

        </div>
        {% empty %}
        <p class="text-[#0245a3]/50 text-sm">No recent activity.</p>
        {% endfor %}
    </div>
</div>



        </div>
    </div>
</div>

<style>
    .animation-delay-2000 { animation-delay: 2s; }
</style>
{% endblock %}
